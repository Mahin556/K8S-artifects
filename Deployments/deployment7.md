# Kubernetes Example Deployment

In this example, we will perform the following steps:

1. Create a namespace
2. Create a Nginx deployment
3. Create a Nginx service
4. Expose and access the Nginx service

> **Note:** While some of these operations can be performed directly using `kubectl`, we will use YAML specifications to understand the concepts better.

---

## Exercise Setup

Create a folder for this exercise:

```bash
mkdir deployment-demo && cd deployment-demo
```

All YAML files will be created inside this folder.

---

## Step 1: Create a Namespace

Create a file named `namespace.yaml`:

```yaml
apiVersion: v1
kind: Namespace
metadata:
  name: deployment-demo
  labels:
    apps: web-based
  annotations:
    type: demo
```

Create the namespace:

```bash
kubectl create -f namespace.yaml
```

Equivalent `kubectl` command without YAML:

```bash
kubectl create namespace deployment-demo
```

---

## Step 2: Assign Resource Quota

To prevent pods from consuming more resources than allowed, create a file named `resourceQuota.yaml`:

```yaml
apiVersion: v1
kind: ResourceQuota
metadata:
  name: mem-cpu-quota
  namespace: deployment-demo
spec:
  hard:
    requests.cpu: "4"
    requests.memory: 8Gi
    limits.cpu: "8"
    limits.memory: 16Gi
```

Create the resource quota:

```bash
kubectl create -f resourceQuota.yaml
```

Check the resource quota:

```bash
kubectl describe ns deployment-demo
```

**Expected output:**

```
Name:         deployment-demo
Labels:       apps=web-based
Annotations:  type=demo
Status:       Active

Resource Quotas
 Name:            mem-cpu-quota
 Resource         Used  Hard
 --------         ---   ---
 limits.cpu       0     2
 limits.memory    0     2Gi
 requests.cpu     0     1
 requests.memory  0     1Gi
```

---

## Step 3: Create a Deployment

Create a file named `deployment.yaml`:

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx
  labels:
    app: nginx
  namespace: deployment-demo
  annotations:
    monitoring: "true"
spec:
  replicas: 1
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx
        ports:
        - containerPort: 80
        resources:
          limits:
            memory: "2Gi"
            cpu: "1000m"
          requests: 
            memory: "1Gi"
            cpu: "500m"
```

Create the deployment:

```bash
kubectl create -f deployment.yaml
```

Check the deployment:

```bash
kubectl get deployments -n deployment-demo
```

View the deployment in YAML format (including autogenerated fields):

```bash
kubectl get deployment nginx -n deployment-demo --output yaml
```

---

## Step 4: Create a Service and Expose the Deployment

Create a file named `service.yaml`:

```yaml
apiVersion: v1
kind: Service
metadata:
  name: nginx
  namespace: deployment-demo
  labels:
    app: nginx
spec:
  selector:
    app: nginx
  ports:
    - port: 80
      targetPort: 80
      nodePort: 30500
      protocol: TCP
  type: NodePort
```

Create the service:

```bash
kubectl create -f service.yaml
```

Check the service:

```bash
kubectl get services -n deployment-demo
```

You can now access Nginx on **any Kubernetes node IP** at port `30500`, for example:

```
http://<NODE_IP>:30500/
```

> **Explanation:** The service uses a selector `app=nginx` to route traffic to all pods with the same label. This ensures requests to the service reach the correct deployment automatically.

### References
- https://devopscube.com/kubernetes-deployment-tutorial/